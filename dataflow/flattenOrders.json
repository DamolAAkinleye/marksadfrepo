{
	"name": "flattenOrders",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CosmosDbSqlApiOrders",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "sqlorders",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "Flatten1"
				},
				{
					"name": "DerivedColumn1"
				}
			],
			"script": "source(output(\n\t\torderID as string,\n\t\tcustomerID as string,\n\t\temployeeID as string,\n\t\torderDate as string,\n\t\trequiredDate as string,\n\t\tshippedDate as string,\n\t\tshipVia as string,\n\t\tfreight as double,\n\t\tshipName as string,\n\t\tshipAddress as (street as string, city as string, region as string, postalCode as string, country as string),\n\t\tdetails as (productID as string, unitPrice as string, quantity as string, discount as string)[]\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'document',\n\tthroughput: 5000) ~> source1\nsource1 foldDown(unroll(details),\n\tmapColumn(\n\t\torderID,\n\t\tcustomerID,\n\t\temployeeID,\n\t\torderDate,\n\t\trequiredDate,\n\t\tshippedDate,\n\t\tshipVia,\n\t\tfreight,\n\t\tshipName,\n\t\tshipAddress,\n\t\tdetails\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> Flatten1\nFlatten1 derive(details = @(productID=details.productID,\n\t\tunitPrice=details.unitPrice,\n\t\tquantity=details.quantity,\n\t\tdiscount=details.discount,\n\t\ttotalAmount=toString(round(toInteger(details.quantity)*toInteger(details.unitPrice),2),'###.##'))) ~> DerivedColumn1\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\trecreate:true,\n\tformat: 'table',\n\tmapColumn(\n\t\torderDate,\n\t\trequiredDate,\n\t\tshippedDate,\n\t\tshipVia,\n\t\tfreight,\n\t\tshipName,\n\t\tcity = shipAddress.city,\n\t\tpostalCode = shipAddress.postalCode,\n\t\ttotalAmount = details.totalAmount\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
		}
	}
}