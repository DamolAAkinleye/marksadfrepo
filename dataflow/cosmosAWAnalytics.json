{
	"name": "cosmosAWAnalytics",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "cosmos_factsales",
						"type": "DatasetReference"
					},
					"name": "factsales"
				},
				{
					"dataset": {
						"referenceName": "cosmos_dimcust",
						"type": "DatasetReference"
					},
					"name": "dimcust"
				},
				{
					"dataset": {
						"referenceName": "cosmos_dimprod",
						"type": "DatasetReference"
					},
					"name": "dimprod"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "CosmosDbAwDwMetrics",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "Join1"
				},
				{
					"name": "Join2"
				},
				{
					"name": "Select1"
				},
				{
					"name": "SalesByOwnerByMarried"
				},
				{
					"name": "SalesByColorStyle"
				},
				{
					"name": "AvgSalesByCarsAndChildren"
				},
				{
					"name": "Sort1"
				},
				{
					"name": "Sort2"
				},
				{
					"name": "Sort3"
				},
				{
					"name": "Union1"
				},
				{
					"name": "DerivedColumn1"
				}
			],
			"script": "\n\nsource(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'document') ~> factsales\nsource(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'document') ~> dimcust\nsource(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'document') ~> dimprod\nfactsales, dimcust join(factsales@CustomerKey == dimcust@CustomerKey,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join1\nJoin1, dimprod join(factsales@ProductKey == dimprod@ProductKey,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join2\nJoin2 select(mapColumn(\n\t\tOrderDateKey,\n\t\tOrderQuantity,\n\t\tProductStandardCost,\n\t\tSalesAmount,\n\t\tTaxAmt,\n\t\tTotalProductCost,\n\t\tUnitPrice,\n\t\tAddressLine1,\n\t\tEnglishEducation,\n\t\tEnglishOccupation,\n\t\tFirstName,\n\t\tGender,\n\t\tHouseOwnerFlag,\n\t\tLastName,\n\t\tMaritalStatus,\n\t\tNumberCarsOwned,\n\t\tNumberChildrenAtHome,\n\t\tPhone,\n\t\tTitle,\n\t\tTotalChildren,\n\t\tClass,\n\t\tColor,\n\t\tEnglishProductName,\n\t\tListPrice,\n\t\tModelName,\n\t\tStyle,\n\t\tWeight\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(MaritalStatus,\n\t\tHouseOwnerFlag),\n\tsalesbyownermarried = toDecimal(sum(SalesAmount),10,2)) ~> SalesByOwnerByMarried\nSelect1 aggregate(groupBy(Color,\n\t\tStyle),\n\tsalesbycolorstyle = toDecimal(sum(SalesAmount),10,2)) ~> SalesByColorStyle\nSelect1 aggregate(groupBy(NumberCarsOwned,\n\t\tNumberChildrenAtHome),\n\tavgsales = toDecimal(sum(SalesAmount),10,2)) ~> AvgSalesByCarsAndChildren\nSalesByOwnerByMarried sort(desc(salesbyownermarried, true)) ~> Sort1\nAvgSalesByCarsAndChildren sort(desc(avgsales, true)) ~> Sort2\nSalesByColorStyle sort(desc(salesbycolorstyle, true)) ~> Sort3\nSort1, Sort2, Sort3 union(byName: true)~> Union1\nUnion1 derive(partkey = sha2(salesbyownermarried + salesbycolorstyle + avgsales)) ~> DerivedColumn1\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'document',\n\tpartitionKey: ['/partkey'],\n\tthroughput: 2000) ~> sink1"
		}
	}
}